import requests
from bs4 import BeautifulSoup
import requests
import re
from termcolor import colored

class Proxy:
    def __init__(self):
        pass

    def get_proxy_list(self, protocol):
        try:
            url = "https://api.proxyscrape.com/v2/?request=displayproxies&protocol=" + protocol + "&timeout=10000&country=all&ssl=all&anonymity=all&auth="
            response = requests.get(url)
            filename = str(protocol)+"_proxies.txt"
            with open(filename, "w") as file:
                file.write(response.text.replace('\n', ''))
            ips_found = len(response.text.split('\n'))

            return print(colored(f"{ips_found} IP's saved to {filename}", "green"))
        except Exception as e:
            return print(e)
        
    def get_proxies(self, protocol):
        try:
            filename = str(protocol) + "_proxies.txt"
            with open(filename, "r") as file:
                proxy_list = file.readlines()
                proxy = proxy_list[0].strip()
                del proxy_list[0]
            with open(filename, "w") as file:
                file.writelines(proxy_list)
            proxy = {protocol: str(protocol)+"://"+str(proxy)}
            print(colored(f"Using proxy: {proxy}", "blue"))
            return proxy
        except Exception as e:
            return print(e)